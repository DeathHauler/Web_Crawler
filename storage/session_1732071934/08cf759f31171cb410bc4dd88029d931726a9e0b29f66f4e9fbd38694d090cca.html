<html lang="en" op="item"><head><meta name="referrer" content="origin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" type="text/css" href="news.css?ykIaoHvQeNpS3UJN9n8I">
        <link rel="icon" href="y18.svg">
    <link rel="canonical" href="https://news.ycombinator.com/item?id=42187761"/>            <title>Using Erlang hot code updates | Hacker News</title></head><body><center><table id="hnmain" border="0" cellpadding="0" cellspacing="0" width="85%" bgcolor="#f6f6ef">
        <tr><td bgcolor="#ff6600"><table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px"><tr><td style="width:18px;padding-right:4px"><a href="https://news.ycombinator.com"><img src="y18.svg" width="18" height="18" style="border:1px white solid; display:block"></a></td>
                  <td style="line-height:12pt; height:10px;"><span class="pagetop"><b class="hnname"><a href="news">Hacker News</a></b>
                            <a href="newest">new</a> | <a href="front">past</a> | <a href="newcomments">comments</a> | <a href="ask">ask</a> | <a href="show">show</a> | <a href="jobs">jobs</a> | <a href="submit" rel="nofollow">submit</a>            </span></td><td style="text-align:right;padding-right:4px;"><span class="pagetop">
                              <a href="login?goto=item%3Fid%3D42187761">login</a>
                          </span></td>
              </tr></table></td></tr>
<tr id="pagespace" title="Using Erlang hot code updates" style="height:10px"></tr><tr><td><table class="fatitem" border="0">
        <tr class='athing submission' id='42187761'>
      <td align="right" valign="top" class="title"><span class="rank"></span></td>      <td valign="top" class="votelinks"><center><a id='up_42187761' href='vote?id=42187761&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center></td><td class="title"><span class="titleline"><a href="https://underjord.io/how-i-use-erlang-hot-code-updates.html">Using Erlang hot code updates</a><span class="sitebit comhead"> (<a href="from?site=underjord.io"><span class="sitestr">underjord.io</span></a>)</span></span></td></tr><tr><td colspan="2"></td><td class="subtext"><span class="subline">
          <span class="score" id="score_42187761">155 points</span> by <a href="user?id=lawik" class="hnuser">lawik</a> <span class="age" title="2024-11-19T20:29:03 1732048143"><a href="item?id=42187761">6 hours ago</a></span> <span id="unv_42187761"></span> | <a href="hide?id=42187761&amp;goto=item%3Fid%3D42187761">hide</a> | <a href="https://hn.algolia.com/?query=Using%20Erlang%20hot%20code%20updates&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0" class="hnpast">past</a> | <a href="fave?id=42187761&amp;auth=1a31484dcca2a47fedb61460b267f05c2a4d6a7d">favorite</a> | <a href="item?id=42187761">31&nbsp;comments</a>        </span>
              </td></tr>
            <tr><td style="height:10px"></td></tr><tr><td colspan="2"></td><td><form action="comment" method="post"><input type="hidden" name="parent" value="42187761"><input type="hidden" name="goto" value="item?id=42187761"><input type="hidden" name="hmac" value="39cb3abf6819e96611772eb4bee413e2a93e80be"><textarea name="text" rows="8" cols="80" wrap="virtual"></textarea><br><br>
<input type="submit" value="add comment"></form></td></tr>  </table><br><br><table border="0" class='comment-tree'>
            <tr class='athing comtr' id='42189283'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42189283' href='vote?id=42189283&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=jhgg" class="hnuser">jhgg</a> <span class="age" title="2024-11-19T23:43:09 1732059789"><a href="item?id=42189283">3 hours ago</a></span> <span id="unv_42189283"></span>          <span class='navs'>
             | <a href="#42188905" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189283" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">When I worked at Discord, we used BEAM hot code loading pretty extensively, built a bunch of tooling around it to apply and track hot-patches to nodes (which in turn could update the code on &gt;100M processes in the system.) It allowed us to deploy hot-fixes in minutes (full tilt deploy could complete in a matter of seconds) to our stateful real-time system, rather than the usual ~hour long deploy cycle. We generally only used it for &quot;emergency&quot; updates though.<p>The tooling would let us patch multiple modules at a time, which basically wrapped `:rpc.call&#x2F;4` and `Code.eval_string&#x2F;1` to propagate the update across the cluster, which is to say, the hot-patch was entirely deployed over erlang&#x27;s built-in distribution.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189283&amp;goto=item%3Fid%3D42187761%2342189283" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189462'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189462' href='vote?id=42189462&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=davisp" class="hnuser">davisp</a> <span class="age" title="2024-11-20T00:08:01 1732061281"><a href="item?id=42189462">2 hours ago</a></span> <span id="unv_42189462"></span>          <span class='navs'>
             | <a href="#42189283" class="clicky" aria-hidden="true">parent</a> | <a href="#42188905" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189462" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">This matches my experience. I spent a decade operating Erlang clusters and using hot code upgrades is a superpower for debugging a whole class of hard to track bugs. Although, without the tracking for cluster state it can be its own footgun when a hotpatch gets unpatched during a code deploy.<p>As for relups, I once tried starting a project to make them easier but eventually decided that the number of bazookas pointed at each and every toe made them basically a non-starter for anything that isn’t trivial. And if its trivial it was already covered by the nl (network load, send a local module to all nodes in the cluster and hot load it) style tooling.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189462&amp;goto=item%3Fid%3D42187761%2342189462" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                            <tr class='athing comtr' id='42188905'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42188905' href='vote?id=42188905&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=rozap" class="hnuser">rozap</a> <span class="age" title="2024-11-19T22:47:50 1732056470"><a href="item?id=42188905">4 hours ago</a></span> <span id="unv_42188905"></span>          <span class='navs'>
             | <a href="#42189283" class="clicky" aria-hidden="true">prev</a> | <a href="#42189807" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188905" n="5" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I used to work on a pretty big elixir project that had many clients with long lived connections that ran jobs that weren&#x27;t easily resumable. Our company had a language agnostic deployment strategy based on docker, etc which meant we couldn&#x27;t do hot code updates even though they would have saved our customers some headache.<p>Honestly I wish we had had the ability to do both. Sometimes a change is so tricky that the argument that &quot;hot code updates are complicated and it&#x27;ll cause more issues than it will solve&quot; is very true, and maybe a deploy that forces everyone to reconnect is best for that sort of change. But often times we&#x27;d deploy some mundane thing where you don&#x27;t have to worry about upgrading state in a running gen server or whatever, and it&#x27;d be nice to have minimal impact.<p>Obviously that&#x27;s even more complexity piled onto the system, but every time I pushed some minor change and caused a retry that (in a perfect world at least...) didn&#x27;t <i>need</i> to retry, I winced a bit.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188905&amp;goto=item%3Fid%3D42187761%2342188905" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189011'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189011' href='vote?id=42189011&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=ElevenLathe" class="hnuser">ElevenLathe</a> <span class="age" title="2024-11-19T23:03:53 1732057433"><a href="item?id=42189011">4 hours ago</a></span> <span id="unv_42189011"></span>          <span class='navs'>
             | <a href="#42188905" class="clicky" aria-hidden="true">parent</a> | <a href="#42189807" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189011" n="4" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I work in gaming and have experienced the opposite side of this: many of our services have more than one &quot;kind&quot; of update, each with its own caveats and gotchas, so that it takes an expert in the whole system (meaning really almost ALL of our systems) to determine which would be the least impactful possible one if nothing goes wrong. Not only is there a lot of complexity and lost productivity in managing this process (&quot;Are we sure this change is zero downtime-able?&quot; &quot;Does it need a schema reload?&quot; etc) but we often get it wrong. The result is that, in practice, anything even remotely questionable gets done during a full downtime where we kick players out.<p>It&#x27;s sometimes helpful to have the option to just restart one little corner of the full system, to minimize impact, but it is helpful to <i>customer</i> experience (if we don&#x27;t screw it up) and very much the opposite for <i>developer</i> experience (it&#x27;s crippling to velocity to need to discuss each change with multiple experts and determine the appropriate type of release).</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189011&amp;goto=item%3Fid%3D42187761%2342189011" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189179'><td><table border='0'>  <tr>    <td class='ind' indent='2'><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks">
      <center><a id='up_42189179' href='vote?id=42189179&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=rozap" class="hnuser">rozap</a> <span class="age" title="2024-11-19T23:26:54 1732058814"><a href="item?id=42189179">3 hours ago</a></span> <span id="unv_42189179"></span>          <span class='navs'>
             | <a href="#42188905" class="clicky" aria-hidden="true">root</a> | <a href="#42189011" class="clicky" aria-hidden="true">parent</a> | <a href="#42189807" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189179" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">No doubt that traditional deployments are much better for dev experience at (sometimes) the cost of customer experience.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189179&amp;goto=item%3Fid%3D42187761%2342189179" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189324'><td><table border='0'>  <tr>    <td class='ind' indent='3'><img src="s.gif" height="1" width="120"></td><td valign="top" class="votelinks">
      <center><a id='up_42189324' href='vote?id=42189324&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=ElevenLathe" class="hnuser">ElevenLathe</a> <span class="age" title="2024-11-19T23:48:26 1732060106"><a href="item?id=42189324">3 hours ago</a></span> <span id="unv_42189324"></span>          <span class='navs'>
             | <a href="#42188905" class="clicky" aria-hidden="true">root</a> | <a href="#42189179" class="clicky" aria-hidden="true">parent</a> | <a href="#42189443" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189324" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">One thing that would help both is deployment automation that could examine the desired changes and work out the best way to deploy them without human input. For distributed systems, this would require rock-solid contracts between individual services for all relevant scenarios, and would also require each update to be specified completely in code (or at least something machine readable), ideally in one commit. This is a level of maturity that seems elusive in gaming.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189324&amp;goto=item%3Fid%3D42187761%2342189324" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189443'><td><table border='0'>  <tr>    <td class='ind' indent='3'><img src="s.gif" height="1" width="120"></td><td valign="top" class="votelinks">
      <center><a id='up_42189443' href='vote?id=42189443&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=toast0" class="hnuser">toast0</a> <span class="age" title="2024-11-20T00:05:11 1732061111"><a href="item?id=42189443">3 hours ago</a></span> <span id="unv_42189443"></span>          <span class='navs'>
             | <a href="#42188905" class="clicky" aria-hidden="true">root</a> | <a href="#42189179" class="clicky" aria-hidden="true">parent</a> | <a href="#42189324" class="clicky" aria-hidden="true">prev</a> | <a href="#42189807" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189443" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I disagree. Hot loading means I can have a very short cycle on an issue, and move onto something else. Having to think about the implications of hot loading is worth it for the rapid cycle time and not having to hold as many changes in my mind at once.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189443&amp;goto=item%3Fid%3D42187761%2342189443" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                              <tr class='athing comtr' id='42189807'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42189807' href='vote?id=42189807&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=edude03" class="hnuser">edude03</a> <span class="age" title="2024-11-20T01:01:41 1732064501"><a href="item?id=42189807">2 hours ago</a></span> <span id="unv_42189807"></span>          <span class='navs'>
             | <a href="#42188905" class="clicky" aria-hidden="true">prev</a> | <a href="#42189039" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189807" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">Nerves and hot code reloading got me into erlang after I watched a demo of patching code on a flying drone ~8 years ago.<p>While I can&#x27;t imagine hot reloading is super practicle in production, it does highlight that erlang&#x2F;beam&#x2F;otp has great primitives for building reliable production systems.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189807&amp;goto=item%3Fid%3D42187761%2342189807" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189039'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42189039' href='vote?id=42189039&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=hauxir" class="hnuser">hauxir</a> <span class="age" title="2024-11-19T23:08:40 1732057720"><a href="item?id=42189039">3 hours ago</a></span> <span id="unv_42189039"></span>          <span class='navs'>
             | <a href="#42189807" class="clicky" aria-hidden="true">prev</a> | <a href="#42189286" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189039" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">We use hot code upgrades on kosmi.io with great success.<p>It&#x27;s absolute magic and allows for very rapid development and ease of deploying fixes and updates.<p>We do use have to use distillery though and have had to resort to a bunch of custom glue bash scripts which I wish was more standardized because it&#x27;s such a killer feature.<p>Due to Elixirs efficiency, everything is running on a single node despite thousands of concurrents so haven&#x27;t really experienced how it handles multiple nodes.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189039&amp;goto=item%3Fid%3D42187761%2342189039" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189286'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42189286' href='vote?id=42189286&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=throwaway81523" class="hnuser">throwaway81523</a> <span class="age" title="2024-11-19T23:43:52 1732059832"><a href="item?id=42189286">3 hours ago</a></span> <span id="unv_42189286"></span>          <span class='navs'>
             | <a href="#42189039" class="clicky" aria-hidden="true">prev</a> | <a href="#42188995" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189286" n="4" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">You have to be very very very careful when preparing relups.  The alternative on Linux is to launch an entire new server on the same machine, then transfer the session data and the open sockets to it through IPC.  I once asked Joe Armstrong whether this was as good as relups and why Erlang went the relup route.  I don&#x27;t remember the exact words and don&#x27;t want to misquote him, but he basically said it was fine, and Erlang went with relups and hot patching because transferring connections (I guess they would have been hardware interfaces rather than sockets) wasn&#x27;t possible when they designed the hot patch system.<p>Hot patching is a bit unsatisfying because you are still running the same VM afterwards.  WIth socket migration you can launch a new VM if you want to upgrade your Erlang version.  I don&#x27;t know of a way to do it with existing software, but in principle using something like HAProxy with suitable extensions, it should be possible to even migrate connections across machines.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189286&amp;goto=item%3Fid%3D42187761%2342189286" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189408'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189408' href='vote?id=42189408&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=toast0" class="hnuser">toast0</a> <span class="age" title="2024-11-20T00:00:38 1732060838"><a href="item?id=42189408">3 hours ago</a></span> <span id="unv_42189408"></span>          <span class='navs'>
             | <a href="#42189286" class="clicky" aria-hidden="true">parent</a> | <a href="#42188995" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189408" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">State migration is possible, and yeah, if you want to upgrade BEAM, state migration would be effective, whereas hot loading is not. If your VM gets pretty big, you might need to be careful about memory usage though, the donor VM is likely not going to shrink as fast as the heir VM grows. If you were so inclined, C does allow for hot loading too, but I think it&#x27;d be pretty hard to bend BEAM into something that you could hot load to upgrade.<p>Migrating socket state across machines is possible too, but I don&#x27;t think it&#x27;s anywhere close to mainstream. HAProxy is a lovely tool, but I&#x27;m pretty sure I saw something in its documentation that explicitly states that sort of thing is out of scope; they want to deal with user level sockets.<p>Linux has a TCP Repair feature which can be used as part of socket migration; but you&#x27;ll also need to do something to forward packets to the new destination. Could be arping for the address from a new machine, or something fancier that can switch proportionally or ??? there&#x27;s lots of options, depending on your network.<p>As much as I&#x27;d love to have a use case for TCP migration, it&#x27;s a little bit too esoteric for me ... reconnecting is best avoided when possible, but I&#x27;m counting TCP migration as non-possible for purposes of the rule of thumb.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189408&amp;goto=item%3Fid%3D42187761%2342189408" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189536'><td><table border='0'>  <tr>    <td class='ind' indent='2'><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks">
      <center><a id='up_42189536' href='vote?id=42189536&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=throwaway81523" class="hnuser">throwaway81523</a> <span class="age" title="2024-11-20T00:20:09 1732062009"><a href="item?id=42189536">2 hours ago</a></span> <span id="unv_42189536"></span>          <span class='navs'>
             | <a href="#42189286" class="clicky" aria-hidden="true">root</a> | <a href="#42189408" class="clicky" aria-hidden="true">parent</a> | <a href="#42188995" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189536" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">TCP migration on the same machine is real and it&#x27;s not that big a deal, if that&#x27;s what you meant by TCP migration.  Doing it across machines is at best a theoretical possibility, I would agree.  I have been wanting to look into CRIU more carefully, but I believe it uses TCP Repair that you mentioned.  I&#x27;m unfamiliar with it though.<p>The saying in the Erlang crowd is that a non-distributed system can&#x27;t be really reliable, since the power cord is a single point of failure.  So a non-painful way to migrate across machines would be great.  It just hasn&#x27;t been important enough (I guess) for make anyone willing to deal with the technical obstacles.<p>I wonder whether other OS&#x27;s have supported anything like that.<p>I worked on a phone switch (programmed in C) a long time ago that let you do both software and hardware upgrades (swap CPU boards etc.) while keeping connections intact, but the hardware was specially designed for that.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189536&amp;goto=item%3Fid%3D42187761%2342189536" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189661'><td><table border='0'>  <tr>    <td class='ind' indent='3'><img src="s.gif" height="1" width="120"></td><td valign="top" class="votelinks">
      <center><a id='up_42189661' href='vote?id=42189661&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=toast0" class="hnuser">toast0</a> <span class="age" title="2024-11-20T00:40:00 1732063200"><a href="item?id=42189661">2 hours ago</a></span> <span id="unv_42189661"></span>          <span class='navs'>
             | <a href="#42189286" class="clicky" aria-hidden="true">root</a> | <a href="#42189536" class="clicky" aria-hidden="true">parent</a> | <a href="#42188995" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189661" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">&gt; I wonder whether other OS&#x27;s have supported anything like that.<p>I don&#x27;t think I&#x27;ve seen it, but I don&#x27;t see everything, and it&#x27;d be pretty esoteric. From my memory of working with the FreeBSD tcp stack, I suspect it wouldn&#x27;t be too hard to make something like this work there, too; other than the security aspects, but could probably do something like ok to &#x27;repair&#x27; a connection that matches a listen socket you also pass or something. But you&#x27;d really need the use case to make the hassle worth it, and I don&#x27;t think most regular server applications are enough to warrant it.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189661&amp;goto=item%3Fid%3D42187761%2342189661" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                              <tr class='athing comtr' id='42188995'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42188995' href='vote?id=42188995&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=robocat" class="hnuser">robocat</a> <span class="age" title="2024-11-19T23:01:19 1732057279"><a href="item?id=42188995">4 hours ago</a></span> <span id="unv_42188995"></span>          <span class='navs'>
             | <a href="#42189286" class="clicky" aria-hidden="true">prev</a> | <a href="#42188600" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188995" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">Background to the article: <a href="https:&#x2F;&#x2F;underjord.io&#x2F;unpacking-elixir-iot-embedded-nerves.html" rel="nofollow">https:&#x2F;&#x2F;underjord.io&#x2F;unpacking-elixir-iot-embedded-nerves.ht...</a><p>Seems like they deploy Elixir on embedded Linux. The embedded Linux distro is Nerves which replaces systemd and boots to the BEAM VM instead as process 1, putting Elixir as close to the metal as they can.<p>I know nothing about any of the above (assumption is I&#x27;m fool enough to try and simplify) plus I know I&#x27;ve misused the concepts I wrote but that&#x27;s my point so read the article. All simplifications are salads</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188995&amp;goto=item%3Fid%3D42187761%2342188995" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42188600'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42188600' href='vote?id=42188600&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=whorleater" class="hnuser">whorleater</a> <span class="age" title="2024-11-19T22:05:02 1732053902"><a href="item?id=42188600">5 hours ago</a></span> <span id="unv_42188600"></span>          <span class='navs'>
             | <a href="#42188995" class="clicky" aria-hidden="true">prev</a> | <a href="#42188480" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188600" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">WhatsApp very long ago used to hot reload across all nodes with a ssh script to incrementally deploy during the day</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188600&amp;goto=item%3Fid%3D42187761%2342188600" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42188480'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42188480' href='vote?id=42188480&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=toast0" class="hnuser">toast0</a> <span class="age" title="2024-11-19T21:50:31 1732053031"><a href="item?id=42188480">5 hours ago</a></span> <span id="unv_42188480"></span>          <span class='navs'>
             | <a href="#42188600" class="clicky" aria-hidden="true">prev</a> | <a href="#42189124" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188480" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">&gt; Both have described hot code updates as something that people should learn and use. I imagine Whatsapp’s initial engineering crew would agree. They did pretty well.<p>Yeah. Hot loading is clearly better than anything else when you&#x27;ve got a million clients connected and you want to make a code change. Of course, we didn&#x27;t have any of these fancy &#x27;release&#x27; tools, we just used GNU Make to rsync the code to prod and run erlc. Then you can grab a debug shell and l(module). (we did write utilities to see what code was modified, and to provide the right incantations so we wouldn&#x27;t load if it would kill processes)</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188480&amp;goto=item%3Fid%3D42187761%2342188480" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42188817'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42188817' href='vote?id=42188817&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=rybosome" class="hnuser">rybosome</a> <span class="age" title="2024-11-19T22:35:25 1732055725"><a href="item?id=42188817">4 hours ago</a></span> <span id="unv_42188817"></span>          <span class='navs'>
             | <a href="#42188480" class="clicky" aria-hidden="true">parent</a> | <a href="#42189124" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188817" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">&gt; Hot loading is clearly better than anything else when you&#x27;ve got a million clients connected and you want to make a code change.<p>In the contexts in which I’ve worked, this was solved by issuing a command to the server to enter a lame-duck mode and stop accepting new connections, then restarting the process with updated code after all existing connections ended.<p>This worked in our case because connections had a TTL with a “reasonable” time, couldn’t have been more than an hour. We could always wait it out.<p>I suppose hot reloading is more necessary when you have connections without a set TTL.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188817&amp;goto=item%3Fid%3D42187761%2342188817" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189144'><td><table border='0'>  <tr>    <td class='ind' indent='2'><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks">
      <center><a id='up_42189144' href='vote?id=42189144&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=toast0" class="hnuser">toast0</a> <span class="age" title="2024-11-19T23:22:42 1732058562"><a href="item?id=42189144">3 hours ago</a></span> <span id="unv_42189144"></span>          <span class='navs'>
             | <a href="#42188480" class="clicky" aria-hidden="true">root</a> | <a href="#42188817" class="clicky" aria-hidden="true">parent</a> | <a href="#42189124" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189144" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">That way works, but it means you&#x27;re spending that much more time on a deploy.<p>For a small change, you can hot load your change and be done in minutes. This means you can push several small changes in an hour. Which helps get things done rapidly.<p>It&#x27;s also really nice to be able to see that the change works as expected (or not) at full load right away. If you&#x27;ve got to wait for connections to accumulate on the new server, that takes longer without hot load too.<p>Some changes can&#x27;t be effectively hot loaded[1], and for those you do need to do something to kick out users and let them reconnect elsewhere, and you could do all your updates that way, but it means a lot more client time spent reconnecting.<p>On the one hour TTL. Sometimes that&#x27;s reasonable, but sometimes it&#x27;s really not. Someone downloading a large file on a slow connection is better served by letting the download continue to trickle for hours than forcing them to reconnect and resume. A real time call is better served by letting it run until the participants are done. For someone on a low end phone, staying connected for as long as they can is probably better than forcing a reconnect where they&#x27;ll need to generate new ephemeral keys and do a key exchange exercise.<p>[1] At the very least, BEAM updates and kernel changes are much more easily done by restarting. But not all userspace Erlang changes are easy to make hot loadable, either.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189144&amp;goto=item%3Fid%3D42187761%2342189144" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                        <tr class='athing comtr' id='42189124'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42189124' href='vote?id=42189124&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=aeturnum" class="hnuser">aeturnum</a> <span class="age" title="2024-11-19T23:20:00 1732058400"><a href="item?id=42189124">3 hours ago</a></span> <span id="unv_42189124"></span>          <span class='navs'>
             | <a href="#42188480" class="clicky" aria-hidden="true">prev</a> | <a href="#42188528" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189124" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">IMO Hot Code Updates are a tantalizing tool that can be useful at times but are extremely easy to foot-gun and have little support. I suspect that the reason why no one has built a nice, formal framework for organizing and fanning out hot code changes to erlang nodes is that it&#x27;s very hard to do well, involves making some educated guesses about the halting problem, and generally doesn&#x27;t help you much unless you&#x27;re already in a real bind.<p>Most of the benefits of hot code updates (with better understanding of the boundaries of changes) can be found through judicious rolling restarts that things like k8s make easier these days. Any time you have the capacity to hot patch code on a node, you probably have the capacity to hot patch the node&#x27;s setup as well.<p>That said I think that someone could use the code reloading abilities of erlang to make a genuinely unparalleled production problem diagnostic toolkit - where you can take apart a problem as it is happening in real time. The same kinds of people who are excited about time traveling debugging should be excited about this imo.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189124&amp;goto=item%3Fid%3D42187761%2342189124" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42188528'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42188528' href='vote?id=42188528&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=arnon" class="hnuser">arnon</a> <span class="age" title="2024-11-19T21:56:17 1732053377"><a href="item?id=42188528">5 hours ago</a></span> <span id="unv_42188528"></span>          <span class='navs'>
             | <a href="#42189124" class="clicky" aria-hidden="true">prev</a> | <a href="#42189457" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188528" n="6" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">A few years ago, the biggest problem with Erlang&#x27;s hot code updates was getting the files updated on all of the nodes. Has this been solved or improved in any way?</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188528&amp;goto=item%3Fid%3D42187761%2342188528" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42188728'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42188728' href='vote?id=42188728&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=comboy" class="hnuser">comboy</a> <span class="age" title="2024-11-19T22:20:52 1732054852"><a href="item?id=42188728">4 hours ago</a></span> <span id="unv_42188728"></span>          <span class='navs'>
             | <a href="#42188528" class="clicky" aria-hidden="true">parent</a> | <a href="#42189232" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188728" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I don&#x27;t think updating files is the problem. The biggest issue with hot code updates seems to be that they can create states that cannot be replicated in either release on its own.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188728&amp;goto=item%3Fid%3D42187761%2342188728" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42188800'><td><table border='0'>  <tr>    <td class='ind' indent='2'><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks">
      <center><a id='up_42188800' href='vote?id=42188800&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=ketralnis" class="hnuser">ketralnis</a> <span class="age" title="2024-11-19T22:32:30 1732055550"><a href="item?id=42188800">4 hours ago</a></span> <span id="unv_42188800"></span>          <span class='navs'>
             | <a href="#42188528" class="clicky" aria-hidden="true">root</a> | <a href="#42188728" class="clicky" aria-hidden="true">parent</a> | <a href="#42189026" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42188800" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">This is my experience. About 25% of the time I&#x27;d encounter a bug that&#x27;s impossible to reproduce without both versions of the code in memory, and end up restarting the node anyway dropping requests in the process. Whereas if I&#x27;d have architected around not having hot code updates I could built it in a way that never has to drop requests</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188800&amp;goto=item%3Fid%3D42187761%2342188800" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189026'><td><table border='0'>  <tr>    <td class='ind' indent='2'><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks">
      <center><a id='up_42189026' href='vote?id=42189026&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=faizshah" class="hnuser">faizshah</a> <span class="age" title="2024-11-19T23:06:40 1732057600"><a href="item?id=42189026">4 hours ago</a></span> <span id="unv_42189026"></span>          <span class='navs'>
             | <a href="#42188528" class="clicky" aria-hidden="true">root</a> | <a href="#42188728" class="clicky" aria-hidden="true">parent</a> | <a href="#42188800" class="clicky" aria-hidden="true">prev</a> | <a href="#42189232" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189026" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">In general, you can save your team a lot of ops trouble just by periodically restarting your long running services from scratch instead of trying to keep alive a process or container for a long time.<p>I’m still new to the erlang&#x2F;elixir community and I haven’t run it in prod yet but this is my experience coming from Java, Node, and Python.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189026&amp;goto=item%3Fid%3D42187761%2342189026" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                  <tr class='athing comtr' id='42189232'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189232' href='vote?id=42189232&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=toast0" class="hnuser">toast0</a> <span class="age" title="2024-11-19T23:35:10 1732059310"><a href="item?id=42189232">3 hours ago</a></span> <span id="unv_42189232"></span>          <span class='navs'>
             | <a href="#42188528" class="clicky" aria-hidden="true">parent</a> | <a href="#42188728" class="clicky" aria-hidden="true">prev</a> | <a href="#42189457" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189232" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">There&#x27;s about a thousand different ways to update files on servers?<p>You can build os packages, and push those however you like.<p>You can use rsync.<p>You could push the files over dist, if you want.<p>You could probably do something cool with bittorrent (maybe that trend is over?)<p>If you write Makefiles to push, you can use make -j X to get low effort parallelization, which works ok if your node count isn&#x27;t too big, and you don&#x27;t need as instant as possible updates.<p>Erlang source and beam files don&#x27;t tend to get very large. And most people&#x27;s dist clusters aren&#x27;t very large either; I don&#x27;t think I&#x27;ve seen anyone posting large cluster numbers lately, but I&#x27;d be surprised if anyone was pushing to 10,000 nodes at once. Assuming they&#x27;re well connected, pushing to 10,000 nodes takes some prep, but not that much; if you&#x27;re driving it from your laptop, you probably want an intermediate pusher node in your datacenter, so you can push once from home&#x2F;office internet to the pusher node, and then fork a bunch of pushers in the datacenter to push to the other hosts. If you&#x27;ve got multiple locations and you&#x27;re feeling fancy, have a pusher node at each location, push to the pusher node nearest you; that pushes to the node at each location and from there to individual nodes.<p>Other issues are more pressing; like making sure you write your code so it&#x27;s hotload friendly, and maybe trying to test that to confirm you won&#x27;t use the immense power of hotloading to <i>very</i> rapidly crash all your server processes.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189232&amp;goto=item%3Fid%3D42187761%2342189232" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189502'><td><table border='0'>  <tr>    <td class='ind' indent='2'><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks">
      <center><a id='up_42189502' href='vote?id=42189502&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=samgranieri" class="hnuser">samgranieri</a> <span class="age" title="2024-11-20T00:15:57 1732061757"><a href="item?id=42189502">2 hours ago</a></span> <span id="unv_42189502"></span>          <span class='navs'>
             | <a href="#42188528" class="clicky" aria-hidden="true">root</a> | <a href="#42189232" class="clicky" aria-hidden="true">parent</a> | <a href="#42189457" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189502" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I think Twitter once cobbled together a BitTorrent based deployment strategy for Capistrano called murder, that was a cool read from their eng blog back in the day.<p>I wish I had used a pusher node to deploy things when a colleague was using almost all the upstream bandwidth in the office making a video call when my bosses were giving demo and the fix I coded for an issue discovered during the demo could not deploy via Capistrano</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189502&amp;goto=item%3Fid%3D42187761%2342189502" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                        <tr class='athing comtr' id='42189457'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42189457' href='vote?id=42189457&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=samgranieri" class="hnuser">samgranieri</a> <span class="age" title="2024-11-20T00:07:27 1732061247"><a href="item?id=42189457">3 hours ago</a></span> <span id="unv_42189457"></span>          <span class='navs'>
             | <a href="#42188528" class="clicky" aria-hidden="true">prev</a> | <a href="#42188989" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189457" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I tried to do this back in 2017 as an elixir newbie with distillery, but for some reason just went with standard deploys with distillery. Now it’s just using mix release to build elixir apps in a docker image deployed to k8s.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189457&amp;goto=item%3Fid%3D42187761%2342189457" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42188989'><td><table border='0'>  <tr>    <td class='ind' indent='0'><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks">
      <center><a id='up_42188989' href='vote?id=42188989&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=Thaxll" class="hnuser">Thaxll</a> <span class="age" title="2024-11-19T23:00:01 1732057201"><a href="item?id=42188989">4 hours ago</a></span> <span id="unv_42188989"></span>          <span class='navs'>
             | <a href="#42189457" class="clicky" aria-hidden="true">prev</a> <a class="togg clicky" id="42188989" n="5" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c88">Hot code update is one of those thing I don&#x27;t understand, just use a rolling deployment, problem solved. You have a new version of the code without loosing any connection.<p>It&#x27;s one of those thing that sound nice on paper but a actually couple your runtime with ci&#x2F;cd, if you have anything else beside Erlang what do you do? You now need a second solution to deploy code.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42188989&amp;goto=item%3Fid%3D42187761%2342188989" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                <tr class='athing comtr' id='42189251'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189251' href='vote?id=42189251&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=AlphaWeaver" class="hnuser">AlphaWeaver</a> <span class="age" title="2024-11-19T23:38:15 1732059495"><a href="item?id=42189251">3 hours ago</a></span> <span id="unv_42189251"></span>          <span class='navs'>
             | <a href="#42188989" class="clicky" aria-hidden="true">parent</a> | <a href="#42189231" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189251" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">I&#x27;m not sure that rolling deployments guarantee you won&#x27;t lose connections, depending on the type of connection. Imagine your customer is downloading a large file over a single TCP connection, and you want to upgrade the application mid-download.<p>With rolling deployments, your only choice is to wait until that connection drains by completing or failing the download. If that doesn&#x27;t fit your use case, you&#x27;re out of options.<p>If your application is an Erlang app, you could hot code reload an unaffected part of the application while the download finishes. Or, if the part of the application handling the download is an OTP pattern that supports hot code reloading (like a gen_server) you could even make changes to that module and release e.g. speed improvements mid download stream. This is why Erlang shines in applications like telephony, which it was originally designed for.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189251&amp;goto=item%3Fid%3D42187761%2342189251" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189231'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189231' href='vote?id=42189231&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=fiddlerwoaroof" class="hnuser">fiddlerwoaroof</a> <span class="age" title="2024-11-19T23:35:03 1732059303"><a href="item?id=42189231">3 hours ago</a></span> <span id="unv_42189231"></span>          <span class='navs'>
             | <a href="#42188989" class="clicky" aria-hidden="true">parent</a> | <a href="#42189251" class="clicky" aria-hidden="true">prev</a> | <a href="#42189195" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189231" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">The other perspective on this is that, at some level of your system you are always doing a hot code reload: terraform, kubernetes, etc. are taking a new deployment description in and reconciling it with the existing state of the world. Wouldn’t it be nice if this process was just more code in your preferred programming language rather than YAML soup?<p>BEAM encourages you to structure your program as isolated interacting processes and so it’s not that far from a container runtime in itself.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189231&amp;goto=item%3Fid%3D42187761%2342189231" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189195'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189195' href='vote?id=42189195&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=rozap" class="hnuser">rozap</a> <span class="age" title="2024-11-19T23:29:36 1732058976"><a href="item?id=42189195">3 hours ago</a></span> <span id="unv_42189195"></span>          <span class='navs'>
             | <a href="#42188989" class="clicky" aria-hidden="true">parent</a> | <a href="#42189231" class="clicky" aria-hidden="true">prev</a> | <a href="#42189132" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="42189195" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">But what if you have long lived stateful connections? And you don&#x27;t want a deploy to take forever?<p>Ofc you can say &quot;don&#x27;t do that&quot; but sometimes it&#x27;s just the way it is...<p>But I agree, 99% of the time a rolling update is easier and works fine.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189195&amp;goto=item%3Fid%3D42187761%2342189195" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
            <tr class='athing comtr' id='42189132'><td><table border='0'>  <tr>    <td class='ind' indent='1'><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks">
      <center><a id='up_42189132' href='vote?id=42189132&amp;how=up&amp;goto=item%3Fid%3D42187761'><div class='votearrow' title='upvote'></div></a></center>    </td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead">
          <a href="user?id=nthh" class="hnuser">nthh</a> <span class="age" title="2024-11-19T23:21:10 1732058470"><a href="item?id=42189132">3 hours ago</a></span> <span id="unv_42189132"></span>          <span class='navs'>
             | <a href="#42188989" class="clicky" aria-hidden="true">parent</a> | <a href="#42189195" class="clicky" aria-hidden="true">prev</a> <a class="togg clicky" id="42189132" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span>          </span>
                  </span></div><br><div class="comment">
                  <div class="commtext c00">It could be useful if you have an embedded device that you don&#x27;t want to miss data from, but for most deployments I would agree.</div>
              <div class='reply'>        <p><font size="1">
                      <u><a href="reply?id=42189132&amp;goto=item%3Fid%3D42187761%2342189132" rel="nofollow">reply</a></u>
                  </font>
      </div></div></td></tr>
        </table></td></tr>
                  </table>
  <br><br>
</td></tr>
<tr><td><img src="s.gif" height="10" width="0"><table width="100%" cellspacing="0" cellpadding="1"><tr><td bgcolor="#ff6600"></td></tr></table><br>
<center><span class="yclinks"><a href="newsguidelines.html">Guidelines</a> | <a href="newsfaq.html">FAQ</a> | <a href="lists">Lists</a> | <a href="https://github.com/HackerNews/API">API</a> | <a href="security.html">Security</a> | <a href="https://www.ycombinator.com/legal/">Legal</a> | <a href="https://www.ycombinator.com/apply/">Apply to YC</a> | <a href="mailto:hn@ycombinator.com">Contact</a></span><br><br>
<form method="get" action="//hn.algolia.com/">Search: <input type="text" name="q" size="17" autocorrect="off" spellcheck="false" autocapitalize="off" autocomplete="off"></form></center></td></tr>      </table></center></body>
      <script type='text/javascript' src='hn.js?ykIaoHvQeNpS3UJN9n8I'></script>
  </html>
